# KP-19

遊舎工房 meishi 展に合わせて作成した、実験要素モリモリの 4 キーキーボードです。

メディアキー（音量、再生/停止など）として使うことを想定しています。

- 音楽に同期した LED イルミネーション
  - おそらく初めて SK6812Side LED を採用したキーボード基板
  - 19 は最大 LED 数です

- キーを押した時のハプティック（触覚）フィードバック
  - リニアスイッチにタクタイル感を後付けしたい！的な

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">meishiキーボードもといイルミネーションです！！！ <a href="https://t.co/v1jvpHVXxa">pic.twitter.com/v1jvpHVXxa</a></p>&mdash; ぜろけー🔨 (@zk_phi) <a href="https://twitter.com/zk_phi/status/1127585762080256000?ref_src=twsrc%5Etfw">2019年5月12日</a></blockquote>

----

販売予定はいまのところありません。 meishi 展にて「meishi 交換」を受け付ける予定です。

まだまだ詰めなければいけない箇所が多いので、「わかる人向け」です。

## 遊び方

二つある TRRS ジャックの片方に音楽プレーヤーを、他方にイヤホンやスピーカーを繋ぐと、楽しいです。

精度よく光らせるためには、音楽プレーヤーの音量をかなり上げる必要があります (アンプとか内蔵した方が便利だよな…とは思っています)。

## 実装例

表

![表](imgs/1.jpg)

拡大

![拡大](imgs/2.jpg)

裏

![裏](imgs/3.jpg)

## 組立
### 部品表

基板の他に：

- キーボードとして必須
  - MX 互換スイッチ x 4
  - リセットスイッチ TVBP06 x 1
  - Pro Micro x 1
  - ゴム足 (裏面につける部品より厚いもの) x 4 など

- LED (オプション)
  1. Backlight 用 SK6812MINI x 4
  2. Underglow 用 SK6812MINI x 5
  3. 表面でキースイッチを照らす SK6812SIDE x 10
  - 1 -> 2 -> 3 の順で直列に繋がっているので、1 のみ、1 と 2 のみも可能

- 音声入出力 (オプション)
  - TRRS ジャック MJ4-PP-9 x 2
  - コンデンサ x 1 ... 2.5mm ピッチの積層セラミックコンデンサを想定
  - 同じ値の抵抗 x 2 ... 1/6W サイズのカーボン抵抗を想定
  - フットプリントには 10uF, 100K と書いてありますが、のちにいろいろ試して 1uF, 47K の方が多少安定しました
    - アナログ回路ぜんぜんわからないので誰か教えてください…

- 振動モータ (オプション)
  - トランジスタ 2SC1815 x 1
  - 整流用ダイオード 1N4007 x 1
  - 振動モーター x 1 (秋月の円盤型振動モーターなど。直流でそのまま駆動できるもの)

### 手順

0. Pro Micro にファームを焼いて、コンスルーをつけておく

TODO: ファームウェアのアップロード

1. 失敗しやすいので LED をまずつける (Pro Micro を刺して光ることを確認しながら)

![led1](imgs/led1.jpg)

![led1](imgs/led2.jpg)

SK6812Side は半田付けがかなり難しいです。フラックスを塗って、１ピンだけ予備半田して仮止めしてから、残りのパッドに半田を流す、とするとうまくいきました。 SK6812MINI と同様に熱に弱いので注意してください。

また、ピンの間隔が狭いので、隣のピンにズレてつけてしまったりしないように気をつけてください。ルーペなどで確認しながら進めると快適でした。

2. 残りのリード部品を背の低い順につける
3. 振動モーターを両面テープなどで貼り付けて、裏面のパッドに配線
4. ゴム足を貼って完成

## 課題s

誰か強い人に頑張ってほしいポイントたち

### 振動モーターが微妙

基板にベタッと貼っただけではあまり指に刺激がありませんでした。

長めにブイーと駆動すれば振動は強くなりますが、それはそれでキレがなくなり「タクタイル感」とは程遠いです。

スイッチのステムがバネで基板から浮いているので、そりゃ振動伝わりにくいよねという説が濃厚です。

### アナログ回路が発振する

LED をバチバチ光らせながらイヤホンやスピーカーをつなぐと、うっすら「ピー」という音がずっと聞こえます。

LED をオフにしたり、逆に輝度 MAX にしたりすると鳴らないので、 Neopixel 内部の PWM 制御かなにかが出すノイズを拾ってしまっているんじゃないかと思います。

基板のノイズ対策不足、パスコンがない、カップリングの定数決めがよくない、などがあるかなと思っているんですが、アナログ回路全然わからないので誰か教えてほしいです。

そもそもアンプをつけて S/N を改善したいという話もあります。
